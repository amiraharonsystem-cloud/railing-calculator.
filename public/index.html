async function loadDynamicSchedule() {
    // הקישור לגיליון שלך בפורמט ייצוא ל-CSV
    const sheetId = '1JpM_HhT-EyTclnSP12VlpaZFKZwgfHSGOS4YRPZbbvs';
    const gid = '1424845815'; // ה-ID של הטאב הספציפי
    const url = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${gid}`;

    try {
        const response = await fetch(url);
        const data = await response.text();
        const rows = data.split('\n').map(row => row.split(','));

        const selector = document.getElementById('scheduleSelect');
        selector.innerHTML = '<option value="">-- בחר פרויקט מהלו"ז --</option>';

        // רצים על כל השורות בגיליון
        rows.forEach(row => {
            const testerName = row[11]; // עמודה L בערך - שם הבודק
            const status = row[12];     // עמודה M - סטטוס/הערות
            
            // לוגיקה: רק אמיר אהרון, ורק אם אין הערת "ביטול" או צבע אדום (טקסטואלי)
            if (testerName && testerName.includes("אמיר אהרון") && !status.includes("בוטל")) {
                const opt = document.createElement('option');
                opt.value = row[0]; // מזהה כלשהו
                opt.text = `${row[1]} - ${row[7]} (${row[3]})`; // תאריך - עיר (מזמין)
                
                // הוספת נתונים למילוי אוטומטי
                opt.setAttribute('data-client', row[3]); // שם מזמין
                opt.setAttribute('data-addr', row[5]);   // כתובת
                opt.setAttribute('data-proj', row[0]);   // מס' פרויקט
                opt.setAttribute('data-date', row[1]);   // תאריך
                
                selector.appendChild(opt);
            }
        });
    } catch (e) {
        console.error("לא ניתן לטעון את הלו"ז:", e);
    }
}

// קריאה לפונקציה בטעינה
window.onload = loadDynamicSchedule;
