<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <style>
        body { background: #e0e0e0; margin: 0; padding: 20px; font-family: Calibri, sans-serif; }
        .excel-sheet { background: white; border: 1px solid #999; margin: auto; max-width: 1200px; box-shadow: 0 0 20px rgba(0,0,0,0.2); }
        
        /* Excel Header Styling */
        table { border-collapse: collapse; width: 100%; table-layout: fixed; }
        th, td { border: 1px solid #d1d1d1; padding: 0; height: 25px; font-size: 13px; }
        
        .col-header { background: #f8f9fa; text-align: center; color: #666; font-weight: normal; }
        .row-num { background: #f8f9fa; width: 40px; text-align: center; color: #666; }
        
        /* Logic for "1:1" appearance */
        .section-header { background: #1a237e; color: white; font-weight: bold; padding-right: 10px; }
        .label-cell { background: #f2f2f2; font-weight: bold; text-align: right; padding-right: 5px; }
        
        input, select { width: 100%; height: 100%; border: none; outline: none; padding: 0 5px; box-sizing: border-box; background: transparent; }
        input:focus { background: #fffde7; border: 1px solid #217346; }
        
        .btn-panel { background: #f3f3f3; padding: 15px; text-align: center; border-top: 1px solid #ccc; }
        .save-btn { background: #217346; color: white; padding: 10px 50px; border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="excel-sheet">
    <table>
        <tr>
            <th class="row-num"></th>
            <th class="col-header">C</th><th class="col-header">D</th><th class="col-header">F</th>
            <th class="col-header">G</th><th class="col-header">H</th><th class="col-header">I</th>
            <th class="col-header">J</th><th class="col-header">K</th><th class="col-header">L</th>
        </tr>

        <tr>
            <td class="row-num">1</td>
            <td colspan="9" class="section-header">1. פרטי זיהוי ומינהלה</td>
        </tr>
        
        <tr>
            <td class="row-num">2</td>
            <td class="label-cell">מס' דו"ח:</td><td colspan="3"><input data-addr="H2"></td>
            <td class="label-cell">תאריך:</td><td colspan="4"><input data-addr="L3" type="date"></td>
        </tr>
        <tr>
            <td class="row-num">4</td>
            <td class="label-cell">שם האתר:</td><td colspan="3"><input data-addr="C4"></td>
            <td class="label-cell">קוד פרויקט:</td><td colspan="4"><input data-addr="L4"></td>
        </tr>

        <tr><td class="row-num">40</td><td colspan="9" class="section-header">2. מפרט טכני וחומרים (שורות 45-85)</td></tr>
        <tr>
            <td class="row-num">45</td><td class="label-cell">פרופיל ניצב</td>
            <td><input data-addr="C45" placeholder="חומר"></td>
            <td><input data-addr="F45" placeholder="גמר"></td>
            <td class="label-cell">דרישה:</td><td><input data-addr="H45"></td>
            <td class="label-cell">מסקנה:</td><td colspan="3">
                <select data-addr="L45">
                    <option value=""></option><option value="מתאים">מתאים</option><option value="לא מתאים">לא מתאים</option>
                </select>
            </td>
        </tr>

        <tr><td class="row-num">79</td><td colspan="9" class="section-header">חישובי עומס רוח - מקדמים</td></tr>
        <tr style="background:#f9f9f9">
            <td class="row-num">84</td>
            <td class="label-cell">qb: <input data-addr="F84"></td>
            <td class="label-cell">Ce: <input data-addr="K84"></td>
            <td class="label-cell">CsCd: <input data-addr="L84"></td>
            <td class="label-cell">Cf: <input data-addr="M84"></td>
            <td colspan="2" class="label-cell" style="color:red">Fw (I84):</td>
            <td colspan="3"><input data-addr="I84" style="font-weight:bold"></td>
        </tr>

        <tr><td class="row-num">100</td><td colspan="9" class="section-header">3. תוצאות בדיקת עומסים (10.3.4)</td></tr>
        <tr class="label-cell" style="text-align:center">
            <td class="row-num">#</td><td>סעיף</td><td>סוג</td><td>עומס G</td><td>תזוזה I</td><td>שיורית J</td><td>דרישה K</td><td colspan="3">מסקנה L</td>
        </tr>
        <tr>
            <td class="row-num">107</td>
            <td class="label-cell">10.3.4 א'</td><td>אופקי</td>
            <td><input data-addr="G107"></td><td><input data-addr="I107"></td><td><input data-addr="J107"></td><td><input data-addr="K107"></td>
            <td colspan="3"><select data-addr="L107"><option value="מתאים">מתאים</option><option value="לא מתאים">לא מתאים</option></select></td>
        </tr>

        <tr><td class="row-num">127</td><td colspan="9" class="section-bar" style="background:#1a237e; color:white">4. מליא וסיכום חזותי</td></tr>
        <tr>
            <td class="row-num">132</td>
            <td class="label-cell">מליא (132):</td><td colspan="2">תוצאה: <input data-addr="I132"></td>
            <td class="label-cell">דרישה:</td><td><input data-addr="K132"></td>
            <td class="label-cell">מסקנה:</td><td colspan="3"><select data-addr="L133"><option>מתאים</option></select></td>
        </tr>
    </table>

    <div class="btn-panel">
        <button class="save-btn" onclick="save()">הפק דוח אקסל (העתק מקור 1:1)</button>
    </div>
</div>

<script>
    async function save() {
        const cells = {};
        document.querySelectorAll('[data-addr]').forEach(el => cells[el.getAttribute('data-addr')] = el.value);
        const res = await fetch('/generate-excel', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ cells })
        });
        if(res.ok) {
            const b = await res.blob();
            const a = document.createElement('a');
            a.href = URL.createObjectURL(b);
            a.download = "TI_1142_Final.xlsx";
            a.click();
        }
    }
</script>
</body>
</html>
