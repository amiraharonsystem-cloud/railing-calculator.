<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>דו"ח 1142 סופי</title>
    <style>
        body { font-family: sans-serif; direction: rtl; background: #f0f0f0; margin: 0; }
        .tab-nav { background: #333; display: flex; overflow-x: auto; }
        .tab-nav button { color: white; padding: 15px; border: none; background: none; cursor: pointer; }
        .tab-nav button.active { background: #27ae60; }
        .page { display: none; padding: 20px; max-width: 800px; margin: auto; background: white; }
        .page.active { display: block; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        label { font-weight: bold; font-size: 13px; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ccc; }
        .btn-save { background: #27ae60; color: white; width: 100%; padding: 20px; margin-top: 20px; border: none; font-size: 18px; }
    </style>
</head>
<body>

<div class="tab-nav">
    <button class="active" onclick="show(0)">1. זיהוי ואתר</button>
    <button onclick="show(1)">2. נתוני העמסה (Fser)</button>
    <button onclick="show(2)">3. מפרט זיגוג ורוח</button>
    <button onclick="show(3)">4. תוצאות ובדיקה</button>
</div>

<div class="page active" id="p0">
    <h2>פרטי הלקוח וזיהוי</h2>
    <div class="grid">
        <div><label>תאריך בדיקה</label><input type="date" id="testDate"></div>
        <div><label>קוד פרויקט</label><input type="text" id="projectId"></div>
        <div><label>שם המזמין</label><input type="text" id="clientName"></div>
        <div><label>שם האתר</label><input type="text" id="siteName"></div>
        <div><label>כתובת</label><input type="text" id="siteAddress"></div>
        <div><label>מהות הבדיקה</label><select id="testType"><option>ראשונה</option><option>חוזרת</option></select></div>
        <div><label>תכנון מעקה</label><select id="planStatus"><option>הוגש</option><option>לא הוגש</option></select></div>
        <div><label>חישוב שלד</label><select id="engStatus"><option>הוגש</option><option>לא הוגש</option></select></div>
    </div>
</div>

<div class="page" id="p1">
    <h2>נתונים וערכים לחישוב</h2>
    <div class="grid">
        <div><label>Fser (ק"נ/מ')</label><input type="text" id="Fser"></div>
        <div><label>L1 (מ')</label><input type="text" id="L1"></div>
        <div><label>L2 (מ')</label><input type="text" id="L2"></div>
        <div><label>L מפתח לוח מילוי (מ')</label><input type="text" id="L_fill"></div>
    </div>
</div>

<div class="page" id="p2">
    <h2>מפרט זיגוג וחישובי רוח</h2>
    <div class="grid">
        <div><label>עובי שמשה (מ"מ)</label><input type="text" id="glassThick"></div>
        <div><label>סימון יצרן</label><select id="glassMark"><option>קיים</option><option>לא קיים</option></select></div>
        <div><label>סוג שמשה</label><input type="text" id="glassType"></div>
        <div><label>חפיפה למסגרת (מ"מ)</label><input type="text" id="overlap"></div>
        <div><label>We - לחץ רוח (נ'/מ"ר)</label><input type="text" id="we_val"></div>
        <div><label>S - שטח הלוח (מ"ר)</label><input type="text" id="S_area"></div>
    </div>
</div>

<div class="page" id="p3">
    <h2>תוצאות בדיקה (10.3.4 / 10.3.5)</h2>
    <table border="1" width="100%">
        <tr><th>סעיף</th><th>תזוזה I</th><th>שיורית J</th><th>מסקנה</th></tr>
        <tr><td>10.3.4 א'</td><td><input id="hor_a"></td><td><input id="res_a"></td><td><select id="stat_a"><option>עמד</option><option>לא עמד</option></select></td></tr>
        <tr><td>10.3.4 ב'</td><td><input id="hor_b"></td><td><input id="res_b"></td><td><select id="stat_b"><option>עמד</option><option>לא עמד</option></select></td></tr>
        <tr><td>10.3.5 ג'</td><td><input id="hor_c"></td><td><input id="res_c"></td><td><select id="stat_c"><option>עמד</option><option>לא עמד</option></select></td></tr>
    </table>
    <button class="btn-save" onclick="save()">הורד אקסל - העתק מושלם</button>
</div>

<script>
    function show(i) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.querySelectorAll('.tab-nav button').forEach(b=>b.classList.remove('active'));
        document.getElementById('p'+i).classList.add('active');
        event.target.classList.add('active');
    }
    async function save() {
        const d = {};
        document.querySelectorAll('input, select').forEach(el => d[el.id] = el.value);
        const res = await fetch('/generate-excel', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(d)
        });
        const blob = await res.blob();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = "Report.xlsx";
        a.click();
    }
</script>
</body>
</html>
