<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title> 转" 1142 - 专住 住驻转 拽转</title>
    <style>
        body { font-family: 'Assistant', sans-serif; background: #f4f7f6; padding: 20px; direction: rtl; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border: 2px solid #1a237e; border-radius: 8px; }
        .header { text-align: center; color: #1a237e; border-bottom: 4px solid #1a237e; padding-bottom: 15px; margin-bottom: 25px; }
        .section-header { background: #1a237e; color: white; padding: 10px; margin-top: 30px; font-weight: bold; }
        .admin-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; background: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #1a237e; padding: 8px; text-align: center; }
        th { background: #e8eaf6; }
        .label-cell { text-align: right; font-weight: bold; background: #fafafa; width: 30%; }
        select, input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; background: #fff; }
        .num-input { background: #fffde7; text-align: center; font-weight: bold; }
        .btn-save { background: #2e7d32; color: white; padding: 20px; width: 100%; font-size: 1.5rem; border: none; cursor: pointer; margin-top: 30px; border-radius: 6px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h1>转注转 拽 - 注拽 注驻转 </h1></div>

    <div class="section-header">转专 专 注拽 (D14-D25)</div>
    <div class="admin-grid">
        <div>专 注拽 (D14): 
            <select data-addr="D14">
                <option value="">专...</option>
                <option></option>
                <option>驻</option>
                <option>专住</option>
                <option>转</option>
            </select>
        </div>
        <div>住  (D15): 
            <select data-addr="D15">
                <option value="">专...</option>
                <option></option>
                <option>注</option>
                <option></option>
                <option></option>
            </select>
        </div>
        <div>住  (D16): 
            <select data-addr="D16">
                <option value="">专...</option>
                <option>转</option>
                <option>爪</option>
                <option>驻 拽</option>
            </select>
        </div>
        <div>住 转 (D19): 
            <select data-addr="D19">
                <option value="">专...</option>
                <option>专</option>
                <option>住转 专</option>
                <option>住转</option>
            </select>
        </div>
        <div>拽 拽 (D25): 
            <select data-addr="D25">
                <option value="">专...</option>
                <option>专驻住转</option>
                <option></option>
                <option>专转</option>
            </select>
        </div>
        <div>砖 拽 (D38): 
            <select data-addr="D38">
                <option value="">专...</option>
                <option>专 专</option>
                <option>住专 住拽专拽</option>
                <option>专 专拽</option>
            </select>
        </div>
    </div>

    <script>
        const colL_Options = `
            <option value="">专...</option>
            <option value="转">转</option>
            <option value=" 转"> 转</option>
            <option value=" 专砖"> 专砖</option>
            <option value=" 专"> 专</option>
            <option value=" 拽"> 拽</option>
        `;
    </script>

    <div class="section-header">住注祝 1: 拽转 专 (56-62)</div>
    <table>
        <tr><th>住注祝</th><th>转专</th><th></th><th>住拽 (L)</th><th>注专转 (M)</th></tr>
        <tr><td>7.2.4</td><td class="label-cell"> 注拽</td><td><input data-addr="I56"></td><td><select data-addr="L56"><script>document.write(colL_Options)</script></select></td><td><input data-addr="M56"></td></tr>
        <tr><td>5.1.2</td><td class="label-cell">专 驻住</td><td><input data-addr="I57"></td><td><select data-addr="L57"><script>document.write(colL_Options)</script></select></td><td><input data-addr="M57"></td></tr>
        <tr><td>5.1.4.1</td><td class="label-cell">专 (专 10)</td><td><input data-addr="I58"></td><td><select data-addr="L58"><script>document.write(colL_Options)</script></select></td><td><input data-addr="M58"></td></tr>
    </table>

    <div class="section-header">住注祝 2: 注住 驻拽转 (107-114)</div>
    <table>
        <tr><th>砖</th><th>注住 (H)</th><th>转 (I)</th><th>砖专转 (J)</th><th>住拽 (L)</th></tr>
        <tr><td>' - 爪转</td><td><input id="hLoad" data-addr="H107" readonly class="num-input"></td><td><input id="d1" data-addr="I107" oninput="calcSum()"></td><td><input data-addr="J107"></td><td><select data-addr="L107"><script>document.write(colL_Options)</script></select></td></tr>
        <tr><td>' - </td><td><input id="fLoad" data-addr="H108" oninput="calcHalf()"></td><td><input data-addr="I108"></td><td><input data-addr="J108"></td><td><select data-addr="L108"><script>document.write(colL_Options)</script></select></td></tr>
        <tr><td>' - 爪</td><td><input data-addr="H110"></td><td><input id="d2" data-addr="I110" oninput="calcSum()"></td><td><input data-addr="J110"></td><td><select data-addr="L110"><script>document.write(colL_Options)</script></select></td></tr>
        <tr style="background:#e8f5e9"><td><b>' - 住 转转</b></td><td>-</td><td><input id="totalD" data-addr="I114" readonly class="num-input"></td><td>-</td><td><select data-addr="L114"><script>document.write(colL_Options)</script></select></td></tr>
    </table>

    <div class="section-header">住注祝 3: 注住 拽转 转专驻 (119-132)</div>
    <table>
        <tr><th>转专</th><th>注住 (H)</th><th>转 (I)</th><th>砖专转 (J)</th><th>住拽 (L)</th></tr>
        <tr><td class="label-cell">  (119)</td><td><input data-addr="H119"></td><td><input data-addr="I119"></td><td><input data-addr="J119"></td><td><select data-addr="L119"><script>document.write(colL_Options)</script></select></td></tr>
        <tr><td class="label-cell">驻拽 转专驻 (120)</td><td><input data-addr="H120"></td><td><input data-addr="I120"></td><td><input data-addr="J120"></td><td><select data-addr="L120"><script>document.write(colL_Options)</script></select></td></tr>
        <tr><td class="label-cell"> 专砖 爪 (132)</td><td><input data-addr="H132"></td><td><input data-addr="I132"></td><td><input data-addr="J132"></td><td><select data-addr="L132"><script>document.write(colL_Options)</script></select></td></tr>
    </table>

    <button class="btn-save" onclick="saveToExcel()"> 驻拽  拽住 (专住  注 Dropdowns)</button>
</div>

<script>
    function calcHalf() {
        const full = parseFloat(document.getElementById('fLoad').value) || 0;
        document.getElementById('hLoad').value = (full / 2).toFixed(1);
    }
    function calcSum() {
        const v1 = parseFloat(document.getElementById('d1').value) || 0;
        const v2 = parseFloat(document.getElementById('d2').value) || 0;
        document.getElementById('totalD').value = (v1 + v2).toFixed(2);
    }
    async function saveToExcel() {
        const data = {};
        document.querySelectorAll('[data-addr]').forEach(el => data[el.getAttribute('data-addr')] = el.value);
        
        const response = await fetch('/generate-excel', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ cells: data })
        });
        
        if (response.ok) {
            const blob = await response.blob();
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = `Report_1142.xlsx`;
            link.click();
        }
    }
</script>
</body>
</html>
