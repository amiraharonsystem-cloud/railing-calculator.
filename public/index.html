<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #cfd8dc; padding: 20px; margin: 0; }
        .wrapper { background: white; max-width: 1200px; margin: auto; box-shadow: 0 0 20px rgba(0,0,0,0.3); border-radius: 5px; overflow: hidden; }
        .header { background: #1a237e; color: white; padding: 20px; text-align: center; }
        .section { padding: 15px; border-bottom: 2px solid #1a237e; }
        .section-title { font-weight: bold; color: #1a237e; margin-bottom: 10px; background: #e8eaf6; padding: 5px; }
        
        table { width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed; }
        th, td { border: 1px solid #999; padding: 5px; text-align: center; font-size: 13px; }
        th { background: #f5f5f5; }
        
        input, select { width: 100%; border: none; padding: 5px; box-sizing: border-box; font-family: inherit; }
        input:focus { background: #fffde7; outline: 2px solid #ffc107; }
        .label-cell { text-align: right; background: #fafafa; font-weight: bold; width: 200px; }
        
        .btn-panel { position: sticky; bottom: 0; background: white; padding: 15px; text-align: center; border-top: 2px solid #1a237e; }
        .save-btn { background: #2e7d32; color: white; padding: 15px 60px; font-size: 20px; border: none; cursor: pointer; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="header"><h1>דו"ח מעבדה ת"י 1142 - הזנת נתונים מלאה</h1></div>

    <div class="section">
        <div class="section-title">פרטי זיהוי (שורות 1-10)</div>
        <table>
            <tr>
                <td class="label-cell">שם האתר (C4):</td><td><input data-addr="C4"></td>
                <td class="label-cell">מס' דו"ח (H2):</td><td><input data-addr="H2"></td>
            </tr>
            <tr>
                <td class="label-cell">שם המזמין (C7):</td><td><input data-addr="C7"></td>
                <td class="label-cell">תאריך (L3):</td><td><input data-addr="L3" type="date"></td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">מפרט טכני וחישובי רוח (שורות 45-85)</div>
        <table>
            <tr>
                <th>תיאור</th><th>חומר (C)</th><th>גמר (F/I)</th><th>דרישה (H)</th><th>מסקנה (L)</th>
            </tr>
            <tr>
                <td class="label-cell">פרופיל ניצב (45)</td>
                <td><select data-addr="C45"><option>אלומיניום 6063</option><option>פלדה ST37</option></select></td>
                <td><input data-addr="F45" placeholder="גמר"></td>
                <td><input data-addr="H45" value="לפי תכנון"></td>
                <td><select data-addr="L45"><option>מתאים</option><option>לא מתאים</option></select></td>
            </tr>
        </table>
        <table style="margin-top:10px;">
            <tr>
                <th>מקדם Ce (K84)</th><th>מקדם CsCd (L84)</th><th>מקדם Cf (M84)</th><th>לחץ We (I82)</th>
            </tr>
            <tr>
                <td><input data-addr="K84" placeholder="Ce"></td>
                <td><input data-addr="L84" placeholder="CsCd"></td>
                <td><input data-cell="M84" placeholder="Cf"></td>
                <td><input data-addr="I82" placeholder="We"></td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">תוצאות בדיקה 10.3.4 (שורות 100-117)</div>
        <table>
            <tr>
                <th style="width:150px">סעיף בדיקה</th><th>סוג (D)</th><th>עומס N (G)</th><th>תזוזה I</th><th>שיורית J</th><th>מסקנה L</th>
            </tr>
            <tr>
                <td class="label-cell">10.3.4 א' (אופקי)</td>
                <td><input data-addr="D107" value="שירות"></td>
                <td><input data-addr="G107"></td>
                <td><input data-addr="I107"></td>
                <td><input data-addr="J107"></td>
                <td><select data-addr="L107"><option>מתאים</option><option>לא מתאים</option></select></td>
            </tr>
            <tr>
                <td class="label-cell">10.3.4 ג' (ניצב)</td>
                <td><input data-addr="D111" value="ניצב"></td>
                <td><input data-addr="G111"></td>
                <td><input data-addr="I111"></td>
                <td><input data-addr="J111"></td>
                <td><select data-addr="L111"><option>מתאים</option><option>לא מתאים</option></select></td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">מליא וסיכום (שורות 127-138)</div>
        <table>
            <tr>
                <td class="label-cell">בדיקת מליא (132):</td>
                <td><input data-addr="I127" placeholder="שטח S"></td>
                <td><input data-addr="I132" placeholder="תוצאה"></td>
                <td><select data-addr="L133"><option>מתאים</option></select></td>
            </tr>
            <tr>
                <td class="label-cell">בדיקה חזותית (137):</td>
                <td colspan="2"><input data-addr="I137" placeholder="הערות לבדיקה חזותית"></td>
                <td><select data-addr="L138"><option>מתאים</option></select></td>
            </tr>
        </table>
    </div>

    <div class="btn-panel">
        <button class="save-btn" onclick="downloadExcel()">הורד דוח מלא (כל התאים)</button>
    </div>
</div>

<script>
    async function downloadExcel() {
        const cells = {};
        // אוסף את כל האלמנטים שיש להם כתובת תא
        document.querySelectorAll('[data-addr]').forEach(el => {
            cells[el.getAttribute('data-addr')] = el.value;
        });

        const response = await fetch('/generate-excel', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ cells })
        });

        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "Railing_Report_Complete.xlsx";
        a.click();
    }
</script>
</body>
</html>
