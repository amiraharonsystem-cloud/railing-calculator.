<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>מערכת דוח ת"י 1142 - העתק מקור מלא</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Assistant', sans-serif; background: #f4f4f4; padding: 20px; }
        .container { max-width: 950px; margin: auto; background: white; padding: 30px; border: 1px solid #333; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        .header-title { text-align: center; font-weight: 800; font-size: 1.8rem; border-bottom: 3px solid #000; margin-bottom: 20px; padding-bottom: 10px; }
        
        .row { display: grid; grid-template-columns: 220px 1fr; border-bottom: 1px solid #ddd; padding: 12px 0; align-items: center; }
        .row.header-row { background: #1a237e; color: white; padding: 8px 15px; font-weight: bold; border: none; margin-top: 20px; }
        
        label { font-weight: 700; color: #333; font-size: 1.1rem; }
        input, select, textarea { padding: 10px; border: 1px solid #bbb; border-radius: 4px; font-size: 1.1rem; width: 100%; box-sizing: border-box; }
        
        .signature-section { margin-top: 40px; padding-top: 20px; border-top: 2px solid #000; display: grid; grid-template-columns: 1fr 1fr; gap: 50px; }
        
        .btn-container { text-align: center; margin-top: 40px; }
        .btn-save { background: #2e7d32; color: white; padding: 20px 80px; font-size: 1.5rem; font-weight: 800; border: none; border-radius: 8px; cursor: pointer; }
        .btn-save:hover { background: #1b5e20; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-title">תעודת בדיקת מעקה במעטפת הבנין</div>

    <div class="row header-row">1. פרטי הלקוח והזיהוי (שורות 1-14)</div>
    <div class="row"><label>מס' דוח (L2):</label><input data-addr="L2"></div>
    <div class="row"><label>תאריך בדיקה (L3):</label><input data-addr="L3" type="date"></div>
    <div class="row"><label>שם האתר (L4):</label><input data-addr="L4"></div>
    <div class="row"><label>שם המזמין (L7):</label><input data-addr="L7"></div>
    <div class="row"><label>מען המזמין (L8):</label><input data-addr="L8"></div>
    <div class="row">
        <label>סוג הבדיקה (L10):</label>
        <select data-addr="L10">
            <option value="ראשונה">ראשונה</option>
            <option value="חוזרת">חוזרת</option>
        </select>
    </div>
    <div class="row"><label>תיאור המבנה (L12):</label><input data-addr="L12"></div>
    <div class="row"><label>מקום הבדיקה (L14):</label><input data-addr="L14"></div>

    <div class="row header-row">2. מפרט ודגם (שורות 15-20)</div>
    <div class="row"><label>סגנון/דגם המעקה (L15):</label><input data-addr="L15"></div>
    <div class="row"><label>ניצב המעקה (L16):</label><input data-addr="L16"></div>
    <div class="row"><label>חישוב עומס רוח (L17):</label><input data-addr="L17"></div>

    <div class="row header-row">3. תוצאות התאמה לדרישות (שורות 28-31)</div>
    <div class="row">
        <label>התאמה לסעיף מס' 1 (L28):</label>
        <select data-addr="L28"><option>מתאים</option><option>לא מתאים</option></select>
    </div>
    <div class="row">
        <label>התאמה לסעיף מס' 2 (L29):</label>
        <select data-addr="L29"><option>מתאים</option><option>לא מתאים</option></select>
    </div>
    <div class="row">
        <label>התאמה לסעיף מס' 3 (L30):</label>
        <select data-addr="L30"><option>מתאים</option><option>לא מתאים</option></select>
    </div>
    <div class="row">
        <label>התאמה לסעיף מס' 4 (L31):</label>
        <select data-addr="L31"><option>מתאים</option><option>לא מתאים</option></select>
    </div>

    <div class="row header-row">4. הערות וסיכום</div>
    <div class="row" style="display: block;">
        <label>הערות הבודק (L32):</label>
        <textarea data-addr="L32" rows="4"></textarea>
    </div>
    
    <div class="signature-section">
        <div>
            <label>שם הבודק (L145):</label>
            <input data-addr="L145" placeholder="שם מלא">
        </div>
        <div style="text-align: left;">
            <label>חתימת המעבדה</label>
            <div style="height: 60px; border: 1px dashed #ccc; margin-top: 10px; display: flex; align-items: center; justify-content: center; color: #999;">מקום לחתימה</div>
        </div>
    </div>

    <div class="btn-container">
        <button class="btn-save" onclick="generate()">הפק דוח אקסל מקורי (1:1)</button>
    </div>
</div>

<script>
    async function generate() {
        const cells = {};
        document.querySelectorAll('[data-addr]').forEach(el => cells[el.getAttribute('data-addr')] = el.value);
        
        const res = await fetch('/generate-excel', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ cells })
        });
        
        if(res.ok) {
            const blob = await res.blob();
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = "Final_Report_1142.xlsx";
            a.click();
        }
    }
</script>
</body>
</html>
