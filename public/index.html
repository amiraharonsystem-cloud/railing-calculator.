<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: "Arial", sans-serif; background: #fafafa; direction: rtl; padding: 20px; }
        .doc-page { background: white; width: 210mm; margin: auto; padding: 40px; border: 1px solid #ddd; }
        .table-section { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .table-section td { border: 1px solid #000; padding: 5px; font-size: 13px; }
        .header-title { text-align: center; font-weight: bold; font-size: 18px; text-decoration: underline; }
        .input-inline { border: none; border-bottom: 1px dotted #000; width: 100%; outline: none; }
        .bg-gray { background: #f0f0f0; font-weight: bold; width: 180px; }
        .btn-submit { background: #000; color: #fff; padding: 15px; width: 100%; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="doc-page">
    <div class="header-title">תעודת בדיקת מעקה במעטפת הבניין - ת"י 1142</div>
    <br>
    
    <table class="table-section">
        <tr>
            <td class="bg-gray">שם האתר:</td><td><input id="siteName" class="input-inline"></td>
            <td class="bg-gray">קוד פרויקט:</td><td><input id="projectId" class="input-inline"></td>
            <td class="bg-gray">תאריך בדיקה:</td><td><input type="date" id="testDate" class="input-inline"></td>
        </tr>
    </table>

    <div style="font-weight: bold;">1. פרטי הלקוח וזיהוי ההזמנה</div>
    <table class="table-section">
        <tr><td class="bg-gray">שם המזמין:</td><td colspan="3"><input id="clientName" class="input-inline"></td></tr>
        <tr>
            <td class="bg-gray">מען המזמין:</td><td><input id="clientAddress" class="input-inline"></td>
            <td class="bg-gray">נציג המזמין:</td><td><input id="presenterName" class="input-inline"></td>
        </tr>
        <tr><td class="bg-gray">כתובת האתר:</td><td colspan="3"><input id="siteAddress" class="input-inline"></td></tr>
        <tr><td class="bg-gray">הבדיקה הינה:</td><td colspan="3"><select id="testType"><option>ראשונה</option><option>חוזרת</option></select></td></tr>
    </table>

    <div style="font-weight: bold;">2. פרטים על המערכת והצהרות</div>
    <table class="table-section">
        <tr><td class="bg-gray">תכנון המעקה:</td><td><select id="planOk"><option>הוגש (V)</option><option>לא הוגש (X)</option></select></td></tr>
        <tr><td class="bg-gray">חישוב הנדסי שלד:</td><td><select id="engOk"><option>הוגש (V)</option><option>לא הוגש (X)</option></select></td></tr>
        <tr><td class="bg-gray">חישוב לוח מליא:</td><td><select id="glassOk"><option>הוגש (V)</option><option>לא הוגש (X)</option></select></td></tr>
    </table>

    <div style="font-weight: bold;">3. נתונים וערכים לחישוב (P = Fser...)</div>
    <table class="table-section">
        <tr>
            <td>Fser: <input id="Fser" style="width:50px"></td>
            <td>L1: <input id="L1" style="width:50px"></td>
            <td>L2: <input id="L2" style="width:50px"></td>
            <td>P מחושב: <input id="P_calc" style="width:70px"></td>
            <td>L (מפתח מליא): <input id="L_fill" style="width:50px"></td>
        </tr>
    </table>

    <div style="font-weight: bold;">סעיף 10.3.5 ג' (לוח מליא)</div>
    <table class="table-section">
        <tr>
            <td>We (לחץ רוח): <input id="We" style="width:60px"></td>
            <td>S (שטח הלוח): <input id="S_area" style="width:60px"></td>
            <td>Ws (עומס סופי): <input id="Ws_total" style="width:60px"></td>
        </tr>
    </table>

    <div style="font-weight: bold;">תוצאות הבדיקה</div>
    <table class="table-section">
        <tr class="bg-gray"><td>סעיף</td><td>תאור</td><td>תזוזה I</td><td>שיורית J</td><td>מסקנה</td></tr>
        <tr><td>10.3.4 א'</td><td>העמסה אופקית</td><td><input id="hor_1034a"></td><td><input id="res_1034a"></td><td><select id="stat_1034a"><option>עמד</option><option>לא עמד</option></select></td></tr>
        <tr><td>10.3.4 ב'</td><td>מחזורית</td><td><input id="hor_1034b"></td><td><input id="res_1034b"></td><td><select id="stat_1034b"><option>עמד</option><option>לא עמד</option></select></td></tr>
        <tr><td>10.3.5 ג'</td><td>לוח מליא</td><td><input id="hor_1035c"></td><td><input id="res_1035c"></td><td><select id="stat_1035c"><option>עמד</option><option>לא עמד</option></select></td></tr>
    </table>

    <button class="btn-submit" onclick="generate()">הפק אקסל זהה למקור</button>
</div>

<script>
    async function generate() {
        const data = {};
        document.querySelectorAll('input, select').forEach(el => data[el.id] = el.value);
        const res = await fetch('/generate-excel', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
        const blob = await res.blob();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = "Report_1142.xlsx";
        a.click();
    }
</script>
</body>
</html>
