<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>מערכת דיגיטלית לבדיקת מעקות</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1a73e8; --bg: #f8f9fa; --text: #202124; --border: #dadce0; }
        body { font-family: 'Assistant', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; line-height: 1.6; }
        .container { max-width: 1000px; margin: auto; }
        
        .main-header { text-align: center; margin-bottom: 40px; }
        .main-header h1 { font-size: 2.5rem; font-weight: 800; color: var(--primary); margin-bottom: 10px; }

        .card { background: white; border-radius: 16px; padding: 35px; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); border: 1px solid var(--border); }
        .card-h { font-size: 1.6rem; font-weight: 700; color: var(--primary); margin-bottom: 25px; border-bottom: 2px solid #e8f0fe; padding-bottom: 10px; }

        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; }
        .field { display: flex; flex-direction: column; }
        .field.full { grid-column: span 2; }
        
        label { font-weight: 600; font-size: 1.2rem; margin-bottom: 10px; color: #3c4043; }
        input, select, textarea { 
            padding: 15px; border: 2px solid var(--border); border-radius: 10px; font-size: 1.2rem; 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); outline: none; background: #fff;
        }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(26,115,232,0.1); background: #fff; }

        .sub-title { font-weight: 700; font-size: 1.3rem; margin: 15px 0 5px 0; color: #5f6368; grid-column: span 2; }

        .footer { position: sticky; bottom: 30px; text-align: center; margin-top: 50px; }
        .btn-submit { 
            background: #2e7d32; color: white; border: none; padding: 20px 100px; font-size: 1.6rem; 
            font-weight: 700; border-radius: 60px; cursor: pointer; box-shadow: 0 10px 30px rgba(46,125,50,0.3);
            transition: transform 0.2s;
        }
        .btn-submit:hover { transform: translateY(-3px); background: #1b5e20; }
    </style>
</head>
<body>

<div class="container">
    <div class="main-header">
        <h1>דוח בדיקת מעקה</h1>
        <p>ת"י 1142 - הזנת נתוני בדיקה והפקת דוח</p>
    </div>

    <div class="card">
        <div class="card-h">פרטי הפרויקט והמזמין</div>
        <div class="grid">
            <div class="field"><label>מספר דו"ח</label><input data-addr="L2" placeholder="לדוגמה: 2024-001"></div>
            <div class="field"><label>תאריך הבדיקה</label><input data-addr="L3" type="date"></div>
            <div class="field full"><label>שם המזמין</label><input data-addr="L7"></div>
            <div class="field full"><label>כתובת האתר</label><input data-addr="L8"></div>
            <div class="field"><label>מקום הבדיקה במבנה</label><input data-addr="L14" placeholder="קומה, מרפסת וכו'"></div>
            <div class="field"><label>סוג בדיקה</label>
                <select data-addr="L10"><option>ראשונה</option><option>חוזרת</option></select>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-h">תיאור המעקה והחומרים</div>
        <div class="grid">
            <div class="field full"><label>דגם המעקה</label><input data-addr="L15"></div>
            
            <div class="sub-title">פרופיל ניצב</div>
            <div class="field"><label>סוג חומר</label><input data-addr="C45"></div>
            <div class="field"><label>גמר (צבע/ציפוי)</label><input data-addr="F45"></div>
            
            <div class="sub-title">זכוכית</div>
            <div class="field"><label>סוג ועיבוד</label><input data-addr="G70"></div>
            <div class="field"><label>עובי (מ"מ)</label><input data-addr="G67" type="number" step="0.1"></div>
        </div>
    </div>

    <div class="card">
        <div class="card-h">תוצאות בדיקת עומסים</div>
        <div class="grid">
            <div class="sub-title">בדיקת עומס אופקי (10.3.4 א')</div>
            <div class="field"><label>עומס מופעל (N)</label><input data-addr="G107" type="number"></div>
            <div class="field"><label>תזוזה תחת עומס (מ"מ)</label><input data-addr="I107" type="number" step="0.01"></div>
            
            <div class="sub-title">בדיקת עומס משולב (10.3.4 ד')</div>
            <div class="field"><label>עומס מופעל (N)</label><input data-addr="G113" type="number"></div>
            <div class="field"><label>תזוזה שיורית (מ"מ)</label><input data-addr="J113" type="number" step="0.01"></div>
            
            <div class="field full" style="margin-top:20px;">
                <label>מסקנה לבדיקת עומסים</label>
                <select data-addr="L107">
                    <option value="מתאים">עומד בדרישות</option>
                    <option value="לא מתאים">אינו עומד בדרישות</option>
                </select>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-h">סיכום וממצאים חזותיים</div>
        <div class="field full">
            <label>ממצאים חזותיים (חיבורים, עיגונים, סדקים)</label>
            <textarea data-addr="I137" rows="4" placeholder="הקלד כאן את ממצאי הבדיקה החזותית..."></textarea>
        </div>
        <div class="grid" style="margin-top:25px;">
            <div class="field full">
                <label>שורה תחתונה - מסקנה סופית</label>
                <select data-addr="L138" style="background: #e8f5e9; font-weight: 700; border-color: #2e7d32;">
                    <option value="מתאים">המעקה תקין ועומד בדרישות ת"י 1142</option>
                    <option value="לא מתאים">המעקה אינו תקין ואינו עומד בדרישות</option>
                </select>
            </div>
        </div>
    </div>

    <div class="footer">
        <button class="btn-submit" onclick="generateExcel()">הפק דוח אקסל מקצועי</button>
    </div>
</div>

<script>
    async function generateExcel() {
        const cells = {};
        document.querySelectorAll('[data-addr]').forEach(el => cells[el.getAttribute('data-addr')] = el.value);
        
        const res = await fetch('/generate-excel', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ cells })
        });

        if(res.ok) {
            const blob = await res.blob();
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Report_1142_${new Date().toLocaleDateString('he-IL')}.xlsx`;
            link.click();
        }
    }
</script>
</body>
</html>
