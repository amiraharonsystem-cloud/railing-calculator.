<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>דו"ח מעבדה ת"י 1142</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma; background: #eee; direction: rtl; padding: 10px; }
        .paper { background: white; max-width: 900px; margin: auto; padding: 30px; border: 1px solid #ccc; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h2 { border-bottom: 2px solid #000; padding-bottom: 5px; font-size: 18px; }
        .row { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 15px; }
        .field { flex: 1; min-width: 200px; }
        label { display: block; font-size: 13px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border: 1px solid #999; }
        .v-check { display: flex; align-items: center; gap: 10px; background: #f9f9f9; padding: 10px; border: 1px solid #ddd; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #000; padding: 8px; text-align: center; }
        .btn { background: #000; color: #fff; padding: 15px; width: 100%; border: none; font-weight: bold; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>

<div class="paper">
    <h2>1. פרטי הלקוח וזיהוי ההזמנה</h2>
    <div class="row">
        <div class="field"><label>שם המזמין</label><input type="text" id="clientName"></div>
        <div class="field"><label>קוד פרויקט</label><input type="text" id="projectId"></div>
        <div class="field"><label>תאריך בדיקה</label><input type="date" id="testDate"></div>
    </div>
    <div class="row">
        <div class="field"><label>שם האתר</label><input type="text" id="siteName"></div>
        <div class="field"><label>כתובת האתר</label><input type="text" id="siteAddress"></div>
        <div class="field">
            <label>מהות הבדיקה</label>
            <select id="testType"><option>ראשונה</option><option>חוזרת</option></select>
        </div>
    </div>

    <h2>2. סטטוס מסמכים (לפני הבדיקה)</h2>
    <div class="row">
        <div class="v-check"><label>תכנון מעקה</label><select id="planOk"><option>הוגש</option><option>לא הוגש</option></select></div>
        <div class="v-check"><label>חישוב הנדסי שלד</label><select id="engOk"><option>הוגש</option><option>לא הוגש</option></select></div>
        <div class="v-check"><label>חישוב לוח מילוי</label><select id="glassEngOk"><option>הוגש</option><option>לא הוגש</option></select></div>
    </div>

    <h2>3. נתונים וערכים לחישוב</h2>
    <div class="row">
        <div class="field"><label>Fser (ק"נ/מ')</label><input type="text" id="Fser"></div>
        <div class="field"><label>L1 - מרחק בין ניצבים 'מ</label><input type="text" id="L1"></div>
        <div class="field"><label>L2 - מפתח שדה סמוך 'מ</label><input type="text" id="L2"></div>
        <div class="field"><label>L - מפתח לוח מילוי 'מ</label><input type="text" id="L_fill"></div>
        <div class="field"><label>P - עומס מחושב (ק"נ)</label><input type="text" id="P_load" placeholder="Fser*(0.5L1+0.5L2)"></div>
    </div>

    <h2>4. תוצאות (10.3.4 / 10.3.5)</h2>
    <table>
        <tr>
            <th>סעיף</th>
            <th>תזוזה אופקית (I)</th>
            <th>שיורית (J)</th>
            <th>מסקנה</th>
        </tr>
        <tr><td>10.3.4 א'</td><td><input id="hor_a"></td><td><input id="res_a"></td><td><select id="stat_a"><option>עמד</option><option>לא עמד</option></select></td></tr>
        <tr><td>10.3.4 ב'</td><td><input id="hor_b"></td><td><input id="res_b"></td><td><select id="stat_b"><option>עמד</option><option>לא עמד</option></select></td></tr>
        <tr><td>10.3.5 ג'</td><td><input id="hor_c"></td><td><input id="res_c"></td><td><select id="stat_c"><option>עמד</option><option>לא עמד</option></select></td></tr>
    </table>

    <button class="btn" onclick="send()">הפק דו"ח בדיקה סופי</button>
</div>

<script>
    async function send() {
        const d = {};
        document.querySelectorAll('input, select').forEach(el => d[el.id] = el.value);
        const res = await fetch('/generate-excel', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(d)
        });
        if(res.ok) {
            const blob = await res.blob();
            const a = document.createElement('a');
            a.href = window.URL.createObjectURL(blob);
            a.download = "Report_1142.xlsx";
            a.click();
        }
    }
</script>
</body>
</html>
