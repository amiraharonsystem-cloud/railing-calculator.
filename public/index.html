<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>דו"ח בדיקה ת"י 1142</title>
    <style>
        body { font-family: Arial; direction: rtl; padding: 20px; background: #fdfdfd; }
        .form-page { max-width: 850px; margin: auto; border: 1px solid #000; background: #fff; padding: 40px; }
        .line { display: flex; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .lbl { font-weight: bold; width: 200px; font-size: 14px; }
        input, select { border: 1px solid #ccc; padding: 4px; flex-grow: 1; }
        .section-head { background: #eee; padding: 5px; font-weight: bold; margin: 20px 0 10px; border: 1px solid #000; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #000; padding: 8px; text-align: center; }
        .btn { background: #000; color: #fff; width: 100%; padding: 20px; margin-top: 30px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="form-page">
    <div style="text-align: center; font-weight: bold; font-size: 18px;">תעודת בדיקת מעקה במעטפת הבניין - ת"י 1142</div>
    
    <div class="section-head">1. פרטי הלקוח וזיהוי ההזמנה</div>
    <div class="line"><span class="lbl">שם המזמין:</span><input id="clientName"></div>
    <div class="grid-3">
        <div class="line"><span class="lbl">מען המזמין:</span><input id="clientAddress"></div>
        <div class="line"><span class="lbl">נציג המזמין:</span><input id="presenterName"></div>
        <div class="line"><span class="lbl">תאריך בדיקה:</span><input type="date" id="testDate"></div>
    </div>
    <div class="grid-3">
        <div class="line"><span class="lbl">שם האתר:</span><input id="siteName"></div>
        <div class="line"><span class="lbl">כתובת האתר:</span><input id="siteAddress"></div>
        <div class="line"><span class="lbl">קוד פרויקט:</span><input id="projectId"></div>
    </div>
    <div class="line"><span class="lbl">הבדיקה הינה:</span><select id="testType"><option>ראשונה</option><option>חוזרת</option></select></div>

    <div class="section-head">2. פרטים על המערכת שנבדקה</div>
    <div class="line"><span class="lbl">תיאור המבנה:</span><input id="structureType"></div>
    <div class="line"><span class="lbl">תיאור הפריט:</span><input id="itemDesc"></div>
    <div class="line"><span class="lbl">מיקום הבדיקה:</span><input id="testLocation"></div>
    
    <div class="section-head">לפני הבדיקה (סטטוס מסמכים)</div>
    <div class="grid-3">
        <div class="line"><span>תכנון המעקה:</span><select id="planStatus"><option>הוגש</option><option>לא הוגש</option></select></div>
        <div class="line"><span>חישוב שלד:</span><select id="engStatus"><option>הוגש</option><option>לא הוגש</option></select></div>
        <div class="line"><span>חישוב לוח מליא:</span><select id="glassStatus"><option>הוגש</option><option>לא הוגש</option></select></div>
    </div>

    <div class="section-head">3. נתונים וערכים לחישוב</div>
    <div class="grid-3">
        <div class="line"><span>Fser (ק"נ/מ'):</span><input id="Fser"></div>
        <div class="line"><span>L1 (מ'):</span><input id="L1"></div>
        <div class="line"><span>L2 (מ'):</span><input id="L2"></div>
    </div>
    <div class="grid-3">
        <div class="line"><span>P מחושב:</span><input id="P_calc"></div>
        <div class="line"><span>L מפתח מליא:</span><input id="L_fill"></div>
    </div>

    <div class="section-head">חישוב עומס רוח על לוח מליא (10.3.5 ג')</div>
    <div class="grid-3">
        <div class="line"><span>we (נ'/מ"ר):</span><input id="we_val"></div>
        <div class="line"><span>S - שטח הלוח:</span><input id="S_area"></div>
        <div class="line"><span>ws (עומס כולל):</span><input id="ws_total"></div>
    </div>

    <div class="section-head">תוצאות הבדיקה</div>
    <table>
        <tr><th>מס' סעיף</th><th>תאור</th><th>תזוזה I</th><th>שיורית J</th><th>מסקנה</th></tr>
        <tr><td>10.3.4 א'</td><td>העמסה אופקית מרוכזת</td><td><input id="hor_a"></td><td><input id="res_a"></td><td><select id="stat_a"><option>מתאים</option><option>לא מתאים</option></select></td></tr>
        <tr><td>10.3.4 ב'</td><td>העמסה אופקית מחזורית</td><td><input id="hor_b"></td><td><input id="res_b"></td><td><select id="stat_b"><option>מתאים</option><option>לא מתאים</option></select></td></tr>
        <tr><td>10.3.5 ג'</td><td>העמסה על לוח מליא</td><td><input id="hor_c"></td><td><input id="res_c"></td><td><select id="stat_c"><option>מתאים</option><option>לא מתאים</option></select></td></tr>
    </table>

    <button class="btn" onclick="send()">הפק אקסל זהה לחלוטין למקור</button>
</div>

<script>
    async function send() {
        const d = {};
        document.querySelectorAll('input, select').forEach(el => d[el.id] = el.value);
        const res = await fetch('/generate-excel', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(d)
        });
        const b = await res.blob();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(b);
        a.download = "Railing_Report.xlsx";
        a.click();
    }
</script>
</body>
</html>
