<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>砖 注住 注拽</title>
    <style>
        :root { --primary: #2980b9; --success: #27ae60; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); margin: 0; padding: 15px; display: flex; justify-content: center; }
        .card { background: white; width: 100%; max-width: 500px; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary); margin-bottom: 25px; border-bottom: 2px solid var(--bg); padding-bottom: 10px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .field { margin-bottom: 18px; }
        .full { grid-column: span 2; }
        label { display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px; color: #34495e; }
        select, input { width: 100%; padding: 12px; border: 1px solid #dcdde1; border-radius: 8px; box-sizing: border-box; font-size: 16px; transition: border 0.3s; }
        select:focus, input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 5px rgba(41,128,185,0.2); }
        button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: background 0.3s; }
        button:hover { background: #2471a3; }
        #resultBox { margin-top: 25px; padding: 20px; background: #fff; border: 2px solid #e1e8ed; border-radius: 10px; display: none; }
        #reportText { white-space: pre-wrap; font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.5; color: #2c3e50; }
        .hidden { display: none; }
        .download-btn { background: var(--success); margin-top: 15px; }
    </style>
</head>
<body>
    <div class="card">
        <h2>拽转 注住 注 注拽</h2>
        
        <div class="field">
            <label>住 注拽 *</label>
            <select id="type" onchange="toggleFields()">
                <option value="">注拽 注  </option>
                <option value="驻">注拽 驻</option>
            </select>
        </div>

        <div class="grid">
            <div class="field">
                <label>住驻专 驻专拽 *</label>
                <input type="text" id="projId" placeholder="砖: 101">
            </div>
            <div class="field">
                <label>砖 转专 / 拽</label>
                <input type="text" id="siteName">
            </div>
        </div>

        <div id="windSection" class="grid">
            <div class="field full">
                <label>注专 *</label>
                <select id="city"></select>
            </div>
            <div class="field">
                <label>  (')</label>
                <input type="number" id="hb" value="30.00" step="1">
            </div>
            <div class="field">
                <label>专转 住驻住</label>
                <select id="terrain">
                    <option value="0.234">专 IV: 注专</option>
                    <option value="0.215">专 III: 专</option>
                    <option value="0.190">专 II: 驻转</option>
                </select>
            </div>
        </div>

        <div class="grid">
            <div class="field">
                <label>L1 驻转 (')</label>
                <input type="number" id="l1" value="1.50" step="0.01">
            </div>
            <div class="field">
                <label>L2 驻转 (')</label>
                <input type="number" id="l2" value="1.50" step="0.01">
            </div>
        </div>

        <button onclick="calculate()">爪注 砖 爪 </button>

        <div id="resultBox">
            <div id="reportText"></div>
            <button class="download-btn" onclick="downloadHTML()"> 砖专  HTML</button>
        </div>
    </div>

    <script>
        const CITY_MAP = {
            " 砖": 26, "驻拽": 24, "专 ": 24, "专 注拽": 24, "转": 24, "注": 24,
            "砖": 24, "砖拽": 24, "专 砖注": 24, "转 砖砖": 26, " 专拽": 24, "转 ": 24,
            "注转": 24, "专爪": 24, "专": 24, "": 24, "驻": 24, "专": 24, 
            "专砖": 26, "驻专 住": 24, "注--专注转": 26, "转": 24, "驻转 转拽": 24, 
            "爪驻转": 28, "专砖 爪": 24, "专转": 24, "专转 ": 24, "转 -驻": 24
        };

        const citySelect = document.getElementById('city');
        Object.keys(CITY_MAP).sort().forEach(city => {
            let opt = document.createElement('option');
            opt.value = city; opt.innerHTML = city;
            citySelect.appendChild(opt);
        });

        function toggleFields() {
            const isSteel = document.getElementById('type').value === '驻';
            document.getElementById('windSection').style.display = isSteel ? 'none' : 'grid';
        }

        function calculate() {
            const type = document.getElementById('type').value;
            const projId = document.getElementById('projId').value;
            const l1 = parseFloat(document.getElementById('l1').value);
            const l2 = parseFloat(document.getElementById('l2').value);
            const hr = 1.05; //  注拽 拽注
            const u = "'/\"";
            
            if (!projId) { alert("  住驻专 驻专拽"); return; }

            let Fser, fw = 0, infoLine = "";

            if (type === '') {
                const city = document.getElementById('city').value;
                const vb = CITY_MAP[city];
                const hb = parseFloat(document.getElementById('hb').value);
                const ceFactor = parseFloat(document.getElementById('terrain').value);
                
                const ze = Math.max(hb + hr, 2.0);
                const logVal = Math.log(ze / 1.0); // 砖 拽专 专 IV
                const ce = (0.234 * logVal) * (1 + 7 / logVal); 
                const we = 0.613 * Math.pow(vb, 2) * ce * 1.8;
                fw = we * hr;
                Fser = Math.ceil(Math.max(fw, 750 + (fw / 2)));
                infoLine = `拽: ${city} | 注住 专: ${fw.toFixed(2)} ${u}`;
            } else {
                Fser = 750;
                infoLine = `住 注拽 驻 - 注住 砖专转 住住`;
            }

            const res_b = Math.ceil(Fser * l1 * 0.75);
            const res_a = Math.ceil(res_b / 2);
            const res_g = Math.ceil(0.5 * Fser * (0.5 * l2 + 0.5 * l1));
            const res_d = Math.ceil(Fser * (0.5 * l2 + 0.125 * l1));
            const res_h = Math.ceil(Fser * (0.5 * l2 + 0.5 * l1));

            let report = `===  转爪转 砖 - ${type} ===\n`;
            report += `转专: ${new Date().toLocaleDateString('he-IL')}\n`;
            report += `驻专拽: ${projId} | ${infoLine}\n`;
            report += `注住 专 (Fser): ${Fser} ${u}\n`;
            report += `------------------------------------\n`;
            report += `住注祝 ' (爪 注住): ${res_a} ${u}\n`;
            report += `住注祝 ' (注住 ): ${res_b} ${u}\n`;
            report += `住注祝 ' ():   ${res_g} ${u}\n`;
            report += `住注祝 ' (驻):     ${res_d} ${u}\n`;
            report += `住注祝 ' (拽爪):      ${res_h} ${u}\n`;

            document.getElementById('reportText').innerText = report;
            document.getElementById('resultBox').style.display = 'block';
            window.scrollTo(0, document.body.scrollHeight);
        }

        function downloadHTML() {
            const report = document.getElementById('reportText').innerText;
            const proj = document.getElementById('projId').value;
            const city = document.getElementById('type').value === '' ? document.getElementById('city').value : "驻";
            const htmlContent = `<html><body dir="rtl" style="font-family:monospace; padding:50px;">${report.replace(/\n/g, '<br>')}</body></html>`;
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `_注住_${proj}_${city}.html`;
            link.click();
        }
    </script>
</body>
</html>
