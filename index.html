
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>תעודת בדיקת מעקה - גרסת ווב</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ===== CSS קל ===== -->
  <style>
    body { font-family: "Segoe UI", Arial, sans-serif; background:#f8f9fa; color:#222; margin:0; padding:18px; }
    h1 { margin: 0 0 12px; font-size: 28px; }
    .ready { background:#e8f5e9; border:1px solid #2e7d32; padding:10px; border-radius:8px; margin-bottom:10px; }
    .tabs { display:flex; gap:8px; margin: 16px 0; flex-wrap:wrap; }
    .tabs button { background:#fff; border:1px solid #ddd; padding:10px 18px; border-radius:8px; cursor:pointer; }
    .tabs button.active { background:#2980b9; color:#fff; border-color:#2980b9; }
    .tab { display:none; background:#fff; border:1px solid #ddd; border-radius:10px; padding:16px; }
    .tab.active { display:block; }
    .grid { display:grid; grid-template-columns: repeat(2, minmax(280px, 1fr)); gap:14px 24px; align-items:center; }
    .grid label { font-weight:600; }
    .grid input, .grid select, .grid textarea {
      width:100%; font-size:16px; padding:8px; border:1px solid #ccc; border-radius:8px; box-sizing:border-box; text-align:right;
    }
    .grid textarea { min-height: 80px; }
    .actions { margin-top:18px; display:flex; gap:12px; flex-wrap:wrap; }
    .actions button { background:#27ae60; color:#fff; border:none; padding:12px 18px; border-radius:8px; font-weight:700; cursor:pointer; }
    .actions button.secondary { background:#2980b9; }
    .note { font-size:13px; color:#555; margin-top:8px; }
    .mono { font-family: "Courier New", monospace; background:#fbfbfb; border:1px dashed #ccc; padding:12px; border-radius:8px; white-space:pre-wrap; }
  </style>

  <!-- ספרייה ראשית: XlsxPopulate (גלובלי: XlsxPopulate) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx-popxlsx-populate.min.js</script>
  <!-- Fallback: טעינת SheetJS (XLSX) אם XlsxPopulate לא נטענת -->
  <script>
    (function ensureExcelLib(){
      if (typeof window.XlsxPopulate === 'undefined') {
        var s = document.createElement('script');
        s.src = "https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js";
        s.onload = function(){ console.log("SheetJS (XLSX) loaded as fallback"); };
        document.head.appendChild(s);
      }
    })();
  </script>

  <!-- קובץ הלוגיקה שלך -->
  <script src="script.js" deferody>
  <!-- רנדור מיידי כדי שלא תראה מסך לבן -->
  <div class="ready">הדף נטען בהצלחה – אם אינך רואה את הטפסים מתחת, עשה רענון קשיח (Ctrl+Shift+R).</div>

  <h1>תעודת בדיקת מעקה - גרסת ווב</h1>

  <div class="tabs" id="tabs">
    <button type="button" data-tab="t1" class="active" aria-controls="t1">פרטי לקוח והזמנה</button>
    <button type="button" data-tab="t2" aria-controls="t2">פרטי מערכת</button>
    <button type="button" data-tab="t3" aria-controls="t3">חישובים</button>
    <button type="button" data-tab="t4" aria-controls="t4">תוצאות ודוח</button>
    <button type="button" data-tab="t5" aria-controls="t5">אקסל (תבנית ויצוא)</button>
  </div>

  <!-- טאב 1 -->
  <section class="tab active" id="t1">
    <div class="grid">
      <label>תאריך בדיקה</label> <input type="date" id="inspectionDate" />
      <label>שם האתר</label> <input type="text" id="siteName" placeholder="שם אתר / לקוח" />
      <label>קוד/מספר פרויקט *</label> <input type="text" id="projectId" placeholder="מספר פרויקט" />
      <label>שם המזמין</label> <input type="text" id="customerName" placeholder="שם המזמין" />
      <label>מען המזמין</label> <input type="text" id="customerAddress" placeholder="מען" />
      <label>נציג המזמין בבדיקה</label> <input type="text" id="customerRep" placeholder="שם הנציג" />
      <label>כתובת האתר</label> <input type="text" id="siteAddress" placeholder="כתובת האתר" />
      <label>הערות</label> <textarea id="notes" placeholder="הערות"></textarea>
      <label>שם הבודק</label> <input type="text" id="inspectorName" value="אמיר אהרון" />
      <label>שם המאשר ותפקידו</label> <input type="text" id="approverTitle" value="מנהל מערך מערכות בניין - אינג' אלברט גורודניצקי" />
    </div>
  </section>

  <!-- טאב 2 -->
  <section class="tab" id="t2">
    <div class="grid">
      <label>סוג מעקה *</label>
      <select id="railingType">
        <option value="">בחר</option>
        <option>מעקה עם לוח מילא</option>
        <option>מעקה פלדה</option>
      </select>

      <label>עיר *</label>
      <select id="city"></select>

      <label>דרגת חספוס פני השטח</label>
      <select id="terrain"></select>

      <label>גובה בניין (מ')</label>
      <input type="number" step="0.01" id="hb" value="30.00" />

      <label>גובה מעקה hr (מ')</label>
      <input type="number" step="0.01" id="hr" value="1.05" />

      <label>מפתח L1 (מ')</label>
      <input type="number" step="0.01" id="l1" value="1.50" />

      <label>מפתח L2 (מ')</label>
      <input type="number" step="0.01" id="l2" value="1.50" />

      <label>אורך לוח מילא (מ')</label>
      <input type="number" step="0.01" id="pw" value="0.99" />

      <label>גובה לוח מילא (מ')</label>
      <input type="number" step="0.01" id="ph" value="0.99" />

      <label>תיאור המבנה</label>
      <input type="text" id="structureDesc" placeholder="תיאור המבנה" />

      <label>תיאור הפריט שנבדק</label>
      <input type="text" id="itemDesc" placeholder="תיאור הפריט" />

      <label>מיקום הבדיקה</label>
      <input type="text" id="inspectionLocation" placeholder="מיקום הבדיקה" />
    </div>

    <p class="note">ערים, מהירויות רוח (vb) וחספוס שטח תואמים לקוד המקורי שלך.</p>
    <div class="actions">
      <button class="secondary" type="button" id="btnCalc">בצע חישוב</button>
    </div>
  </section>

  <!-- טאב 3 -->
  <section class="tab" id="t3">
    <div class="mono" id="calcOutput">עדיין לא בוצע חישוב.</div>
    <div class="actions">
      <button class="secondary" type="button" id="btnRecalc">חשב מחדש</button>
    </div>
  </section>

  <!-- טאב 4 -->
  <section class="tab" id="t4">
    <div class="mono" id="reportArea">הדוח יופיע כאן לאחר חישוב.</div>
    <div class="actions">
      <button type="button" id="btnCopy">העתק דוח</button>
    </div>
  </section>

  <!-- טאב 5 -->
  <section class="tab" id="t5">
    <div class="grid">
      <label>טעינת תבנית אקסל</label>
      <input type="file" id="excelTemplate" accept=".xlsx" />
      <label>הגיליונות שיתווספו אוטומטית</label>
      <input type="text" id="extraSheets" value="קלט,חישובים" />
    </div>
    <details><summary>LABEL_MAP</summary><div class="mono" id="labelMapShow"></div></details>
    <div class="actions">
      <button class="secondary" type="button" id="btnPlant">שתול בתבנית והורד</button>
    </div>
  </section>
</body>
</html>
