<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ×”×¤×§×ª ×“×•×—×•×ª ××¢×§×” - ×ª"×™ 1142</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --p: #1a4a7a; --s: #27ae60; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); direction: rtl; margin: 0; padding: 15px; }
        .container { max-width: 600px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 8px solid var(--p); }
        h2 { text-align: center; color: var(--p); margin-bottom: 25px; }
        .section { background: #fdfdfd; padding: 15px; border-radius: 10px; border: 1px solid #eee; margin-bottom: 15px; }
        .section-title { font-weight: bold; color: var(--p); border-bottom: 2px solid #eee; margin-bottom: 12px; display: block; }
        label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 5px; color: #444; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; margin-bottom: 12px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-main { width: 100%; padding: 20px; background: var(--s); color: white; border: none; border-radius: 12px; font-size: 20px; font-weight: bold; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 0 #1e8449; }
        .btn-main:active { transform: translateY(3px); box-shadow: none; }
        .check-box { display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #fff; border: 1px solid #eee; border-radius: 6px; margin-bottom: 5px; }
        .check-box select { width: auto; margin: 0; padding: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2>×ª×¢×•×“×ª ×‘×“×™×§×ª ××¢×§×” ××¨×¤×¡×ª</h2>

    <div class="section">
        <span class="section-title">1. ×¤×¨×˜×™ ×”×œ×§×•×— ×•×–×™×”×•×™</span>
        <div class="grid">
            <div><label>×“×•"×— ××¡' *</label><input type="text" id="report_id" placeholder="×—×•×‘×”"></div>
            <div><label>×¡×•×’ ×‘×“×™×§×”</label>
                <select id="test_type">
                    <option value="×¨××©×•× ×”">×¨××©×•× ×”</option>
                    <option value="×—×•×–×¨×ª">×—×•×–×¨×ª</option>
                </select>
            </div>
        </div>
        <label>×©× ×”××–××™×Ÿ</label><input type="text" id="client_name">
        <label>×›×ª×•×‘×ª ×”××ª×¨</label><input type="text" id="site_addr">
    </div>

    <div class="section">
        <span class="section-title">2. × ×ª×•× ×™ ×—×™×©×•×‘ ×”× ×“×¡×™</span>
        <label>×¢×™×¨ ×œ×‘×“×™×§×” *</label>
        <select id="city_sel">
            <option value="×ª×œ ××‘×™×‘-×™×¤×•">×ª×œ ××‘×™×‘-×™×¤×•</option>
            <option value="×™×¨×•×©×œ×™×">×™×¨×•×©×œ×™×</option>
            <option value="×—×™×¤×”">×—×™×¤×”</option>
            <option value="××©×“×•×“">××©×“×•×“</option>
            <option value="×‘××¨ ×©×‘×¢">×‘××¨ ×©×‘×¢</option>
            <option value="× ×ª× ×™×”">× ×ª× ×™×”</option>
            <option value="×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ">×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ</option>
            <option value="×¤×ª×— ×ª×§×•×•×”">×¤×ª×— ×ª×§×•×•×”</option>
            <option value="××©×§×œ×•×Ÿ">××©×§×œ×•×Ÿ</option>
            <option value="×‘×™×ª ×©××©">×‘×™×ª ×©××©</option>
        </select>
        <div class="grid">
            <div><label>×’×•×‘×” ×‘× ×™×™×Ÿ (×')</label><input type="number" id="hb" value="30.00"></div>
            <div><label>L1 ×—×–×™×ª (×')</label><input type="number" id="l1" value="1.50"></div>
        </div>
    </div>

    <div class="section">
        <span class="section-title">3. × ×ª×•× ×™ ×œ×•×— ××œ×™× (S, L)</span>
        <div class="grid">
            <div><label>×©×˜×— ×”×œ×•×— S (×"×¨)</label><input type="number" id="s_area" value="1.00"></div>
            <div><label>××¤×ª×— ×œ×•×— L (×')</label><input type="number" id="l_width" value="1.00"></div>
        </div>
        <div class="grid">
            <div><label>S1 (×')</label><input type="number" id="s1_val" value="0.00"></div>
            <div><label>S2 (×')</label><input type="number" id="s2_val" value="0.00"></div>
        </div>
    </div>

    <div class="section">
        <span class="section-title">4. ×¡×˜×˜×•×¡ ×‘×“×™×§×”</span>
        <div class="check-box"><span>×‘×“×™×§×” ×—×–×•×ª×™×ª:</span><select id="v_visual"><option value="××ª××™×">××ª××™× âœ…</option><option value="×œ× ××ª××™×">×œ× ××ª××™× âŒ</option></select></div>
        <div class="check-box"><span>×‘×“×™×§×” ×’×™××•××˜×¨×™×ª:</span><select id="v_geo"><option value="××ª××™×">××ª××™× âœ…</option><option value="×œ× ××ª××™×">×œ× ××ª××™× âŒ</option></select></div>
        <div class="check-box"><span>×œ×•×— ××œ×™×:</span><select id="v_panel"><option value="××ª××™×">××ª××™× âœ…</option><option value="×œ× ××ª××™×">×œ× ××ª××™× âŒ</option></select></div>
    </div>

    <button class="btn-main" onclick="exportToExcel()">ğŸ“Š ×”×¤×§ ××§×¡×œ ×‘×“×™×•×§ ×›××• ×”××§×•×¨</button>
</div>

<script>
    const CITY_DATA = {"×ª×œ ××‘×™×‘-×™×¤×•":24,"×™×¨×•×©×œ×™×":26,"×—×™×¤×”":24,"××©×“×•×“":24,"×‘××¨ ×©×‘×¢":24,"× ×ª× ×™×”":24,"×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ":24,"×¤×ª×— ×ª×§×•×•×”":24,"××©×§×œ×•×Ÿ":24,"×‘×™×ª ×©××©":26};

    function exportToExcel() {
        try {
            const rid = document.getElementById('report_id').value;
            if(!rid) { alert("× × ×œ×”×–×™×Ÿ ××¡×¤×¨ ×“×•×—"); return; }

            const city = document.getElementById('city_sel').value;
            const vb = CITY_DATA[city] || 24;
            const hb = parseFloat(document.getElementById('hb').value);
            const l1 = parseFloat(document.getElementById('l1').value);

            // ×—×™×©×•×‘ ×¢×•××¡×™× ×œ×¤×™ ×”× ×•×¡×—××•×ª ×‘××§×¡×œ ×”××§×•×¨×™
            const ze = Math.max(hb + 1.05, 2.0);
            const logZ = Math.log(ze / 1.0);
            const ce = (0.234 * logZ) * (1 + 7 / logZ);
            const we = 0.613 * Math.pow(vb, 2) * ce * 1.8;
            const Fser = Math.ceil(Math.max(we * 1.05, 750 + ((we * 1.05) / 2)));

            // ×‘× ×™×™×ª ××‘× ×” ×”× ×ª×•× ×™× (AO_A) ×œ×˜×•×‘×ª ×”-CSV/XLSX
            const rows = [
                ["×ª×¢×•×“×ª ×‘×“×™×§×ª ××¢×§×” ×‘××¢×˜×¤×ª ×”×‘× ×™×™×Ÿ"],
                ["××¡×¤×¨ ×“×•×—:", rid, "", "×¡×•×’ ×‘×“×™×§×”:", document.getElementById('test_type').value],
                ["×©× ×”××–××™×Ÿ:", document.getElementById('client_name').value],
                ["×›×ª×•×‘×ª ×”××ª×¨:", document.getElementById('site_addr').value],
                ["×ª××¨×™×š:", new Date().toLocaleDateString('he-IL')],
                [""],
                ["× ×ª×•× ×™ ×ª×›× ×•×Ÿ ×•×”× ×“×¡×”"],
                ["×¢×™×¨:", city, "Vb:", vb, "×/×©"],
                ["×’×•×‘×” ×‘× ×™×™×Ÿ:", hb, "×œ×—×¥ ×¨×•×— We:", we.toFixed(2)],
                ["×¢×•××¡ ×©×™×¨×•×ª Fser:", Fser, "× /×\"×"],
                [""],
                ["× ×ª×•× ×™ ×œ×•×— ××œ×™× (××“×™×“×”)"],
                ["×©×˜×— ×œ×•×— S:", document.getElementById('s_area').value, "××¤×ª×— ×œ×•×— L:", document.getElementById('l_width').value],
                ["S1:", document.getElementById('s1_val').value, "S2:", document.getElementById('s2_val').value],
                [""],
                ["×ª×•×¦××•×ª ×‘×“×™×§×”"],
                ["×‘×“×™×§×” ×—×–×•×ª×™×ª:", document.getElementById('v_visual').value],
                ["×‘×“×™×§×” ×’×™××•××˜×¨×™×ª:", document.getElementById('v_geo').value],
                ["×©×œ××•×ª ×œ×•×—:", document.getElementById('v_panel').value],
                [""],
                ["×—×™×©×•×‘ ×¢×•××¡ × ×™×¦×‘ (×¡×¢×™×£ ×‘'):", Math.ceil(Fser * l1 * 0.75), "× ×™×•×˜×•×Ÿ"]
            ];

            const ws = XLSX.utils.aoa_to_sheet(rows);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "×“×•×—");

            XLSX.writeFile(wb, `Report_${rid}.xlsx`);
        } catch (e) {
            alert("×©×’×™××”: " + e.message);
        }
    }
</script>

</body>
</html>
