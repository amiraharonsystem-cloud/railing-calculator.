<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ×‘×“×™×§×ª ××¢×§×•×ª</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        :root { --p: #1a2a3a; --s: #27ae60; --err: #e74c3c; }
        body { font-family: system-ui, sans-serif; background: #f0f4f8; margin: 0; padding: 10px; }
        .box { background: white; max-width: 450px; margin: auto; padding: 20px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--p); border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .label { display: block; font-weight: bold; margin: 10px 0 5px; font-size: 14px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .btn { width: 100%; padding: 18px; background: var(--s); color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .status-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .status-row select { width: auto; }
    </style>
</head>
<body>

<div class="box">
    <h2>×“×•×— ×‘×“×™×§×ª ××¢×§×”</h2>
    
    <label class="label">××¡×¤×¨ ×¤×¨×•×™×§×˜ *</label>
    <input type="text" id="pid" placeholder="×”×–×Ÿ ××¡×¤×¨">

    <label class="label">×¢×™×¨ ×œ×‘×“×™×§×” *</label>
    <select id="city"></select>

    <div class="grid">
        <div>
            <label class="label">L1 ×—×–×™×ª (×')</label>
            <input type="number" id="l1" value="1.50" step="0.01">
        </div>
        <div>
            <label class="label">L2 ×¤×™× ×” (×')</label>
            <input type="number" id="l2" value="1.50" step="0.01">
        </div>
    </div>

    <div class="grid">
        <div>
            <label class="label">×’×•×‘×” ×‘× ×™×™×Ÿ (×')</label>
            <input type="number" id="hb" value="30">
        </div>
        <div>
            <label class="label">×©×˜×— ×œ×•×— S (×"×¨)</label>
            <input type="number" id="s_val" value="1.00" step="0.01">
        </div>
    </div>

    <div style="margin-top:15px;">
        <div class="status-row">
            <span>×‘×“×™×§×” ×—×–×•×ª×™×ª</span>
            <select id="st1"><option value="×¢×‘×¨">×¢×‘×¨ âœ…</option><option value="× ×›×©×œ">× ×›×©×œ âŒ</option></select>
        </div>
        <div class="status-row">
            <span>×‘×“×™×§×” ×’×™××•××˜×¨×™×ª</span>
            <select id="st2"><option value="×¢×‘×¨">×¢×‘×¨ âœ…</option><option value="× ×›×©×œ">× ×›×©×œ âŒ</option></select>
        </div>
    </div>

    <button class="btn" onclick="runExport()">ğŸ“Š ×”×•×¨×“ ××§×¡×œ ×¢×›×©×™×•</button>
    <p id="msg" style="text-align:center; font-size:12px; color:gray;"></p>
</div>

<script>
    const CITIES = {"××‘×• ×’×•×©":26,"××•×¤×§×™×":24,"××©×“×•×“":24,"××©×§×œ×•×Ÿ":24,"×‘××¨ ×©×‘×¢":24,"×‘×™×ª ×©××©":26,"×‘× ×™ ×‘×¨×§":24,"×‘×ª ×™×":24,"×’×‘×¢×ª×™×™×":24,"×”×¨×¦×œ×™×”":24,"×—×™×¤×”":24,"×™×¨×•×©×œ×™×":26,"× ×ª× ×™×”":24,"×¤×ª×— ×ª×§×•×•×”":24,"×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ":24,"×¨×—×•×‘×•×ª":24,"×ª×œ ××‘×™×‘-×™×¤×•":24};
    
    const cSel = document.getElementById('city');
    Object.keys(CITIES).sort().forEach(c => {
        let o = document.createElement('option'); o.value = c; o.text = c; cSel.add(o);
    });

    function runExport() {
        const msg = document.getElementById('msg');
        msg.innerText = "××¢×‘×“...";
        
        try {
            const pid = document.getElementById('pid').value;
            if(!pid) { alert("×× × ×”×–×Ÿ ××¡×¤×¨ ×¤×¨×•×™×§×˜"); return; }

            const city = document.getElementById('city').value;
            const vb = CITIES[city];
            const hb = parseFloat(document.getElementById('hb').value);
            const l1 = parseFloat(document.getElementById('l1').value);
            const l2 = parseFloat(document.getElementById('l2').value);
            
            // ×—×™×©×•×‘ ×¢×•××¡×™× (×œ×¤×™ × ×•×¡×—××•×ª ×”××§×¡×œ ×©×œ×š)
            const ze = Math.max(hb + 1.05, 2.0);
            const logZ = Math.log(ze / 1.0);
            const ce = (0.234 * logZ) * (1 + 7 / logZ);
            const we = 0.613 * Math.pow(vb, 2) * ce * 1.8;
            const Fser = Math.ceil(Math.max(we * 1.05, 750 + ((we * 1.05) / 2)));

            const data = [
                ["×ª×¢×•×“×ª ×‘×“×™×§×ª ××¢×§×” - ×“×•×— " + pid],
                ["×ª××¨×™×š:", new Date().toLocaleDateString('he-IL')],
                ["×¢×™×¨:", city],
                ["××”×™×¨×•×ª ×¨×•×— (Vb):", vb],
                ["×œ×—×¥ ×¨×•×— (We):", we.toFixed(2)],
                ["×¢×•××¡ ×©×™×¨×•×ª (Fser):", Fser],
                [""],
                ["×ª×•×¦××•×ª ×‘×“×™×§×”:"],
                ["×‘×“×™×§×” ×—×–×•×ª×™×ª:", document.getElementById('st1').value],
                ["×‘×“×™×§×” ×’×™××•××˜×¨×™×ª:", document.getElementById('st2').value],
                [""],
                ["×—×™×©×•×‘×™ ×¢×•××¡ ×¢×œ × ×™×¦×‘×™×:"],
                ["×¡×¢×™×£ ×‘' (×¢×•××¡ ××œ×):", Math.ceil(Fser * l1 * 0.75), "× ×™×•×˜×•×Ÿ"],
                ["×¡×¢×™×£ ×“' (×¤×™× ×”):", Math.ceil(Fser * (0.5 * l2 + 0.125 * l1)), "× ×™×•×˜×•×Ÿ"]
            ];

            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "×“×•×—");

            // ×¤×§×•×“×ª ×”×•×¨×“×”
            XLSX.writeFile(wb, `Report_${pid}.xlsx`);
            msg.innerText = "×”×§×•×‘×¥ ×™×¨×“ ×‘×”×¦×œ×—×”!";
        } catch (e) {
            msg.style.color = "red";
            msg.innerText = "×©×’×™××”: " + e.message;
            console.error(e);
        }
    }
</script>

</body>
</html>
