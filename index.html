<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×“×•×— ×‘×“×™×§×ª ××¢×§×” - ×ª×§×Ÿ 1142</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --success: #27ae60; --fail: #e74c3c; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; padding: 10px; display: flex; justify-content: center; }
        .card { background: white; width: 100%; max-width: 500px; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--primary); font-size: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .section { background: #f9f9f9; padding: 12px; border-radius: 8px; margin: 15px 0; border-right: 4px solid var(--accent); }
        .section-title { font-weight: bold; margin-bottom: 10px; color: var(--primary); font-size: 15px; }
        label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 4px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; box-sizing: border-box; margin-bottom: 10px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .status-box { display: flex; align-items: center; justify-content: space-between; background: white; padding: 10px; border-radius: 6px; border: 1px solid #ddd; margin-bottom: 5px; }
        .status-box span { font-size: 14px; }
        .status-box select { width: auto; margin: 0; padding: 5px; font-size: 14px; }
        button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .excel-btn { background: var(--success); }
    </style>
</head>
<body>

<div class="card">
    <h2>×ª×¢×•×“×ª ×‘×“×™×§×ª ××¢×§×” - ×ª"×™ 1142</h2>
    
    <div class="section">
        <div class="section-title">1. ×¤×¨×˜×™ ×¤×¨×•×™×§×˜ ×•×œ×§×•×—</div>
        <label>××¡×¤×¨ ×¤×¨×•×™×§×˜ *</label>
        <input type="text" id="projId" placeholder="×”×–×Ÿ ××¡×¤×¨ ×“×•×—/×¤×¨×•×™×§×˜">
        <label>×©× ×”××ª×¨ / ×œ×§×•×—</label>
        <input type="text" id="siteName" placeholder="×œ××©×œ: ××’×“×œ×™ ×”×™×">
        <label>×ª××¨×™×š ×‘×“×™×§×”</label>
        <input type="date" id="testDate">
    </div>

    <div class="section">
        <div class="section-title">2. × ×ª×•× ×™ ×¨×•×— ×•×’×™××•××˜×¨×™×”</div>
        <label>×‘×—×¨ ×¢×™×¨ *</label>
        <select id="city"></select>
        <div class="grid">
            <div class="field">
                <label>×’×•×‘×” ×‘× ×™×™×Ÿ (×')</label>
                <input type="number" id="hb" value="30.00" step="0.1">
            </div>
            <div class="field">
                <label>×’×•×‘×” ××¢×§×” (×')</label>
                <input type="number" id="hr" value="1.05" step="0.01">
            </div>
        </div>
        <div class="grid">
            <div class="field">
                <label>L1 (×') *</label>
                <input type="number" id="l1" value="1.50" step="0.01">
            </div>
            <div class="field">
                <label>L2 (×') *</label>
                <input type="number" id="l2" value="1.50" step="0.01">
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">3. ×ª×•×¦××•×ª ×‘×“×™×§×” ×—×–×•×ª×™×ª ×•×’×™××•××˜×¨×™×ª</div>
        <div class="status-box">
            <span>×‘×“×™×§×” ×—×–×•×ª×™×ª</span>
            <select id="visualStatus">
                <option value="×¢×‘×¨">âœ… ×¢×‘×¨</option>
                <option value="×œ× ×¢×‘×¨">âŒ ×œ× ×¢×‘×¨</option>
            </select>
        </div>
        <div class="status-box">
            <span>×‘×“×™×§×” ×’×™××•××˜×¨×™×ª</span>
            <select id="geoStatus">
                <option value="×¢×‘×¨">âœ… ×¢×‘×¨</option>
                <option value="×œ× ×¢×‘×¨">âŒ ×œ× ×¢×‘×¨</option>
            </select>
        </div>
        <div class="status-box">
            <span>×©×œ××•×ª ×œ×•×— ××œ×™×</span>
            <select id="panelStatus">
                <option value="×¢×‘×¨">âœ… ×¢×‘×¨</option>
                <option value="×œ× ×¢×‘×¨">âŒ ×œ× ×¢×‘×¨</option>
            </select>
        </div>
    </div>

    <button onclick="exportToExcel()" class="excel-btn">ğŸ“Š ×”×•×¨×“ ×“×•×— ××§×¡×œ ××œ×</button>
</div>

<script>
    const CITY_MAP = {
        "××‘×• ×’×•×©": 26, "××•×¤×§×™×": 24, "××©×“×•×“": 24, "××©×§×œ×•×Ÿ": 24, "×‘××¨ ×©×‘×¢": 24, 
        "×‘×™×ª ×©××©": 26, "×‘× ×™ ×‘×¨×§": 24, "×‘×ª ×™×": 24, "×’×‘×¢×ª×™×™×": 24, "×”×¨×¦×œ×™×”": 24, 
        "×—×™×¤×”": 24, "×™×¨×•×©×œ×™×": 26, "× ×ª× ×™×”": 24, "×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ": 24, "×ª×œ ××‘×™×‘-×™×¤×•": 24
    };

    const citySelect = document.getElementById('city');
    Object.keys(CITY_MAP).sort().forEach(c => {
        let o = document.createElement('option'); o.value = c; o.text = c; citySelect.add(o);
    });
    document.getElementById('testDate').valueAsDate = new Date();

    function exportToExcel() {
        const proj = document.getElementById('projId').value;
        const city = document.getElementById('city').value;
        if (!proj) { alert("×× × ×”×–×Ÿ ××¡×¤×¨ ×¤×¨×•×™×§×˜"); return; }

        const l1 = parseFloat(document.getElementById('l1').value);
        const l2 = parseFloat(document.getElementById('l2').value);
        const hb = parseFloat(document.getElementById('hb').value);
        const hr = parseFloat(document.getElementById('hr').value);
        
        // ×—×™×©×•×‘ ×¢×•××¡ ×¨×•×— ×œ×¤×™ ×”×§×•×‘×¥ (Log, Ce, We)
        const ze = Math.max(hb + hr, 2.0);
        const logZ = Math.log(ze / 1.0);
        const ce = (0.234 * logZ) * (1 + 7 / logZ);
        const vb = CITY_MAP[city];
        const we = 0.613 * Math.pow(vb, 2) * ce * 1.8;
        const fw = we * hr;
        const Fser = Math.ceil(Math.max(fw, 750 + (
