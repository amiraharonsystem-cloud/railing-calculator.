<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ×‘×“×™×§×ª ××¢×§×” - ×ª"×™ 1142</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; direction: rtl; padding: 20px; display: flex; justify-content: center; }
        .form-container { background: white; width: 100%; max-width: 500px; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { text-align: center; color: #1a4a7a; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 10px; background: #fafafa; }
        .section-title { font-weight: bold; margin-bottom: 10px; display: block; color: #1a4a7a; }
        label { display: block; margin-top: 10px; font-size: 14px; font-weight: 600; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-submit { width: 100%; background: #27ae60; color: white; padding: 18px; border: none; border-radius: 10px; font-size: 20px; font-weight: bold; cursor: pointer; margin-top: 20px; box-shadow: 0 4px 0 #1e8449; }
        .btn-submit:active { transform: translateY(2px); box-shadow: none; }
    </style>
</head>
<body>

<div class="form-container">
    <h2>×“×•×— ×‘×“×™×§×ª ××¢×§×”</h2>

    <div class="section">
        <span class="section-title">×¤×¨×˜×™ ×¤×¨×•×™×§×˜</span>
        <label>××¡×¤×¨ ×“×•×—/×¤×¨×•×™×§×˜ *</label>
        <input type="text" id="report_num" placeholder="×—×•×‘×”">
        <label>×©× ×”××ª×¨ / ×œ×§×•×—</label>
        <input type="text" id="site_name">
        <label>××™×§×•× ×”×‘×“×™×§×”</label>
        <input type="text" id="location_info" placeholder="×§×•××” / ×—×–×™×ª">
    </div>

    <div class="section">
        <span class="section-title">× ×ª×•× ×™ ×—×™×©×•×‘ ×”× ×“×¡×™</span>
        <label>×‘×—×¨ ×¢×™×¨ *</label>
        <select id="city">
            <option value="×ª×œ ××‘×™×‘-×™×¤×•">×ª×œ ××‘×™×‘-×™×¤×•</option>
            <option value="×™×¨×•×©×œ×™×">×™×¨×•×©×œ×™×</option>
            <option value="×—×™×¤×”">×—×™×¤×”</option>
            <option value="×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ">×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ</option>
            <option value="×¤×ª×— ×ª×§×•×•×”">×¤×ª×— ×ª×§×•×•×”</option>
            <option value="××©×“×•×“">××©×“×•×“</option>
            <option value="× ×ª× ×™×”">× ×ª× ×™×”</option>
            <option value="×‘× ×™ ×‘×¨×§">×‘× ×™ ×‘×¨×§</option>
            <option value="×—×•×œ×•×Ÿ">×—×•×œ×•×Ÿ</option>
            <option value="×‘××¨ ×©×‘×¢">×‘××¨ ×©×‘×¢</option>
        </select>
        <div class="grid">
            <div><label>×’×•×‘×” ×‘× ×™×™×Ÿ (×')</label><input type="number" id="hb" value="30"></div>
            <div><label>×’×•×‘×” ××¢×§×” (×')</label><input type="number" id="hr" value="1.05"></div>
        </div>
        <div class="grid">
            <div><label>L1 ×—×–×™×ª (×')</label><input type="number" id="l1" value="1.50"></div>
            <div><label>L2 ×¤×™× ×” (×')</label><input type="number" id="l2" value="1.50"></div>
        </div>
    </div>

    <div class="section">
        <span class="section-title">×ª×•×¦××•×ª ×‘×“×™×§×ª ×©×˜×—</span>
        <label>×‘×“×™×§×” ×—×–×•×ª×™×ª</label>
        <select id="res_visual"><option value="××ª××™×">××ª××™× âœ…</option><option value="×œ× ××ª××™×">×œ× ××ª××™× âŒ</option></select>
        <label>×‘×“×™×§×” ×’×™××•××˜×¨×™×ª</label>
        <select id="res_geo"><option value="××ª××™×">××ª××™× âœ…</option><option value="×œ× ××ª××™×">×œ× ××ª××™× âŒ</option></select>
        <label>×”×¢×¨×•×ª</label>
        <textarea id="notes" rows="2"></textarea>
    </div>

    <button type="button" class="btn-submit" onclick="downloadExcel()">ğŸ“Š ×”×¤×§ ××§×¡×œ ×¢×›×©×™×•</button>
</div>

<script>
    const CITY_WINDS = {"×ª×œ ××‘×™×‘-×™×¤×•":24,"×™×¨×•×©×œ×™×":26,"×—×™×¤×”":24,"×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ":24,"×¤×ª×— ×ª×§×•×•×”":24,"××©×“×•×“":24,"× ×ª× ×™×”":24,"×‘× ×™ ×‘×¨×§":24,"×—×•×œ×•×Ÿ":24,"×‘××¨ ×©×‘×¢":24};

    function downloadExcel() {
        try {
            const reportId = document.getElementById('report_num').value;
            if(!reportId) { alert("×× × ×”×–×Ÿ ××¡×¤×¨ ×“×•×—"); return; }

            const cityName = document.getElementById('city').value;
            const vb = CITY_WINDS[cityName] || 24;
            const hb = parseFloat(document.getElementById('hb').value);
            const hr = parseFloat(document.getElementById('hr').value);
            const l1 = parseFloat(document.getElementById('l1').value);
            const l2 = parseFloat(document.getElementById('l2').value);

            // × ×•×¡×—××•×ª ××”××§×¡×œ ×”××§×•×¨×™
            const ze = Math.max(hb + hr, 2.0);
            const logZ = Math.log(ze / 1.0);
            const ce = (0.234 * logZ) * (1 + 7 / logZ);
            const we = 0.613 * Math.pow(vb, 2) * ce * 1.8;
            const Fser = Math.ceil(Math.max(we * hr, 750 + ((we * hr) / 2)));

            const data = [
                ["×ª×¢×•×“×ª ×‘×“×™×§×ª ××¢×§×” - ×ª×§×Ÿ 1142"],
                ["××¡×¤×¨ ×“×•×—:", reportId],
                ["×ª××¨×™×š:", new Date().toLocaleDateString('he-IL')],
                ["×©× ×”××ª×¨:", document.getElementById('site_name').value],
                ["××™×§×•× ×‘×“×™×§×”:", document.getElementById('location_info').value],
                [""],
                ["× ×ª×•× ×™× ×”× ×“×¡×™×™×:"],
                ["×¢×™×¨:", cityName, "××”×™×¨×•×ª ×¨×•×— (Vb):", vb],
                ["×œ×—×¥ ×¨×•×— (We):", we.toFixed(2), "×¢×•××¡ ×©×™×¨×•×ª (Fser):", Fser],
                [""],
                ["×ª×•×¦××•×ª ×‘×“×™×§×”:"],
                ["×—×–×•×ª×™×ª:", document.getElementById('res_visual').value],
                ["×’×™××•××˜×¨×™×ª:", document.getElementById('res_geo').value],
                [""],
                ["×¢×•××¡ × ×™×¦×‘ ×©×“×”:", Math.ceil(Fser * l1 * 0.75), "× ×™×•×˜×•×Ÿ"],
                ["×¢×•××¡ × ×™×¦×‘ ×¤×™× ×”:", Math.ceil(Fser * (0.5 * l2 + 0.125 * l1)), "× ×™×•×˜×•×Ÿ"],
                ["×”×¢×¨×•×ª:", document.getElementById('notes').value]
            ];

            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "×“×•×—");

            // ×”×•×¨×“×”
            XLSX.writeFile(wb, "Report_" + reportId + ".xlsx");
        } catch (e) {
            alert("×©×’×™××” ×‘×™×¦×™×¨×ª ×”×§×•×‘×¥: " + e.message);
        }
    }
</script>

</body>
</html>
